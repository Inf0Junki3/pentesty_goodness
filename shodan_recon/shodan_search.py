# Simple shodan network scan, part one: grabs shodan info for an IP range.
# Dumps it as a JSON file.

import ipcalc
import json
import shodan
import sys

with open("key.txt") as shodan_keyfile:
    shodan_key = shodan_keyfile.read()

api = shodan.Shodan(shodan_key.strip())

ip_network = ipcalc.Network(sys.argv[1]) 
results = {}

for ip_host in ip_network:
    try:
        host = api.host(str(ip_host))
        results.update({host["ip_str"]: host})
    except Exception:
        results.update({str(ip_host): "No info"})

with open("shodan_results.json", "w") as results_file:
    json.dump(results, results_file)
