#!/usr/bin/python2

# Inf0Junki3, 2016.
# An oldie but a goodie. Select a random address from a pool of non-descript NIC's.
# *Prerequisites:* ip, python.
# NOTES: This *will* disconnect you from the network momentarily.

ACCEPTABLE_OUIS = ["00:05:02", "00:11:43", "00:c0:4f", "00:30:65", "00:50:e4", "08:00:5a",
                   "10:00:5a"]

import argparse
import os
import random
import sys

parser = argparse.ArgumentParser(description = "Select a random address from a pool of non-descript NIC's.")
parser.add_argument("nic", 
                    help="[Required] The interface you want to set, i.e. wlan0")
parser.add_argument("--ouis",
                    help = "[Optional] List of acceptable OUI's. Default: {}".format(
                        " ".join(ACCEPTABLE_OUIS)),
                    nargs = "+",
                    default = ACCEPTABLE_OUIS)

if __name__ == "__main__":
    args = parser.parse_args()
    if os.geteuid() != 0:
        print("You must run this application as root! Exiting.")
        sys.exit(0)
    random_bytes = []
    for i in range(3):
        random_bytes.append(hex(random.randint(0,255))[2:])

    full_address = "{}:{}".format(args.ouis[random.randint(0, len(args.ouis) - 1)],
                                  ":".join(random_bytes))

    print("Using {} as the new mac address for {}".format(full_address, args.nic))
    os.system("ip link set {} down".format(args.nic))
    os.system("ip link set address {} dev {}".format(full_address, args.nic))
