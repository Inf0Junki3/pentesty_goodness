#!/usr/bin/python3

# inf0junki3, 2016.
# Perform recon on domains using certificate transparency.
# *Prerequisites:* python3, feedparser, requests

import feedparser
import requests
import sys
import argparse

base_url = "https://crt.sh/atom?q=%25.{}"

parser = argparse.ArgumentParser(description = "Pull a list of certificate-transparency entries fora set of domains") 
parser.add_argument("--domains", metavar = "D", nargs="+", help = "The domains you wish to search for")

args = parser.parse_args()
domains = args.domains

final_results = []
for cur_domain in domains:
    domain = cur_domain.strip()
    results_raw = requests.get(base_url.format(domain)).content
    results_entries = feedparser.parse(results_raw)["entries"]
    for cur_entry in results_entries:
        entry = cur_entry["summary"][:cur_entry["summary"].index("<br />")].replace("&nbsp;", "\n")
        final_results.append(entry)

for cur_result in final_results:
    result = cur_result.replace(" ", "")
    sys.stdout.buffer.write(result.encode("utf8"))
    sys.stdout.buffer.write("\n".encode("utf8"))
